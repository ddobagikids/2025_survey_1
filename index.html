<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë˜ë°”ê¸° ì–´ë¦°ì´ì§‘ ì¡°í•©ì› ì„¤ë¬¸ì¡°ì‚¬</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #5fa031 0%, #4a7c23 100%);
            min-height: 100vh;
            color: white;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        /* ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í™”ë©´ */
        .password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #5fa031 0%, #4a7c23 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .password-container {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 3rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            max-width: 400px;
            width: 90%;
        }
        
        .password-logo {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 2rem;
            font-weight: bold;
            color: white;
            background-image: url('/assets/logo.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* ë¡œê³  ì´ë¯¸ì§€ê°€ ì—†ì„ ë•Œ ë˜ ê¸€ì ìˆ¨ê¹€ */
        .password-logo:empty {
            /* ê¸€ì í‘œì‹œ ì•ˆí•¨ */
        }
        
        .password-title {
            color: white;
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .password-subtitle {
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 2rem;
            font-size: 1rem;
        }
        
        .password-input,
        .password-button {
            width: 100%;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            box-sizing: border-box;
        }
        
        .password-input {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .password-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .password-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.3);
        }
        
        .password-button {
            background: rgba(255, 255, 255, 0.9);
            color: #4a7c23;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .password-button:hover {
            background: white;
            transform: translateY(-2px);
        }
        
        .password-error {
            color: #fca5a5;
            margin-top: 1rem;
            font-size: 0.9rem;
            display: none;
        }
        
        .main-content {
            display: none;
        }
        
        .main-content.unlocked {
            display: block;
        }
        
        .password-screen.hidden {
            display: none;
        }

        /* í—¤ë” */
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 2rem;
            font-size: 2rem;
            font-weight: bold;
            background-image: url('/assets/logo.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* ë¡œê³  ì´ë¯¸ì§€ê°€ ì—†ì„ ë•Œ ë˜ ê¸€ì ìˆ¨ê¹€ */
        .logo:empty {
            /* ê¸€ì í‘œì‹œ ì•ˆí•¨ */
        }

        .title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 2rem;
        }

        /* í†µê³„ ì¹´ë“œ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 3rem;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            opacity: 1;
            font-size: 0.9rem;
        }

        /* ì„¹ì…˜ ì¹´ë“œ */
        .section-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .section-card:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 2rem;
            cursor: pointer;
        }

        .section-title-area {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .section-icon {
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 48px;
            height: 48px;
        }

        .section-number {
            font-size: 0.9rem;
            opacity: 0.7;
            margin-bottom: 0.25rem;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .section-content {
            padding: 0 2rem 2rem;
            display: none;
        }

        .section-content.active {
            display: block;
        }

        .chevron {
            font-size: 1.5rem;
            transition: transform 0.3s ease;
        }

        .chevron.rotated {
            transform: rotate(180deg);
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        .chart-container {
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .chart-wrapper {
            position: relative;
            height: 500px;
            margin-bottom: 1rem;
        }

        /* ë§Œì¡±ë„ ì ìˆ˜ í‘œì‹œ */
        .satisfaction-score {
            text-align: center;
            padding: 3rem 2rem;
        }

        .score-display {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #fff;
        }

        .score-label {
            font-size: 1.2rem;
            opacity: 0.8;
            margin-bottom: 2rem;
        }

        /* ì„œìˆ í˜• ì‘ë‹µ */
        .narrative-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .narrative-section {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 2rem;
        }

        .narrative-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .quote-card {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: background 0.2s ease;
        }

        .quote-card:hover {
            background: rgba(255, 255, 255, 0.6);
        }

        .quote-text {
            font-style: italic;
            line-height: 1.6;
            color: rgba(74, 124, 35, 0.8);
            font-weight: bold;
        }

        .quote-text:before {
            content: '"';
            font-size: 1.2em;
            color: rgba(74, 124, 35, 0.8);
        }

        .quote-text:after {
            content: '"';
            font-size: 1.2em;
            color: rgba(74, 124, 35, 0.8);
        }



        /* í†µí•© ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .combined-section {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .chart-and-narrative {
            display: grid;
            grid-template-columns: 1fr;
            gap: 2rem;
        }

        /* ë°˜ì‘í˜• ë””ìì¸ */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .title {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 1rem;
            }
            
            .stat-card {
                padding: 1.5rem;
            }
            
            .stat-value {
                font-size: 2rem;
            }
            
            .section-header {
                padding: 1.5rem;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
            
            .chart-wrapper {
                height: 400px;
            }
            
            .narrative-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-and-narrative {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0.5rem;
            }
            
            .title {
                font-size: 1.5rem;
            }
            
            .subtitle {
                font-size: 1rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }
            
            .stat-icon {
                font-size: 2rem;
                margin-bottom: 0.5rem;
            }
            
            .section-header {
                padding: 1rem;
            }
            
            .section-content {
                padding: 0 1rem 1rem;
            }
            
            .chart-wrapper {
                height: 350px;
            }

            .score-display {
                font-size: 3rem;
            }
        }

        /* í”Œë¡œíŒ… ë„¤ë¹„ê²Œì´ì…˜ */
        .floating-nav {
            position: fixed;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            max-height: 80vh;
            overflow-y: auto;
            min-width: 200px;
        }

        .floating-nav h4 {
            color: white;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            text-align: center;
            opacity: 0.9;
        }

        .nav-item {
            display: block;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            margin-bottom: 0.25rem;
            font-size: 0.85rem;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.3);
            color: white;
        }

        /* ëª¨ë°”ì¼ì—ì„œ í”Œë¡œíŒ… ë„¤ë¹„ê²Œì´ì…˜ ìˆ¨ê¹€ */
        @media (max-width: 768px) {
            .floating-nav {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í™”ë©´ -->
    <div class="password-screen" id="passwordScreen">
        <div class="password-container">
            <div class="password-logo"></div>
            <h1 class="password-title">ë˜ë°”ê¸° ì–´ë¦°ì´ì§‘</h1>
            <p class="password-subtitle">ì¡°í•©ì› ì „ìš© ì„¤ë¬¸ì¡°ì‚¬ ê²°ê³¼</p>
            
            <input 
                type="password" 
                class="password-input" 
                id="passwordInput" 
                placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                maxlength="20"
            >
            
            <button class="password-button" onclick="checkPassword()">
                ì…ì¥í•˜ê¸°
            </button>
            
            <div class="password-error" id="passwordError">
                ì˜¬ë°”ë¥¸ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì½˜í…ì¸  -->
    <div class="main-content" id="mainContent">
        <div class="container">
            <!-- í—¤ë” -->
            <header class="header">
                <div class="logo"></div>
                <h1 class="title">ë˜ë°”ê¸° ì–´ë¦°ì´ì§‘ ì¡°í•©ì› ì„¤ë¬¸ì¡°ì‚¬</h1>
                <p class="subtitle">2025ë…„ ìƒë°˜ê¸° ë¶„ì„ ê²°ê³¼</p>
            </header>

            <!-- ìƒë‹¨ í†µê³„ -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-value" id="respondentCount">35ëª…</div>
                    <div class="stat-label">ì¡°í•©ì› ì‘ë‹µì</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">â­</div>
                    <div class="stat-value" id="satisfactionScore">6.6/10</div>
                    <div class="stat-label">ì „ë°˜ì  ë§Œì¡±ë„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘©â€ğŸ«</div>
                    <div class="stat-value" id="teacherScore">7.1/10</div>
                    <div class="stat-label">êµì‚¬íšŒ ë§Œì¡±ë„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</div>
                    <div class="stat-value" id="relationScore">6.3/10</div>
                    <div class="stat-label">ì¡°í•©ì› ê´€ê³„ ë§Œì¡±ë„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸ›ï¸</div>
                    <div class="stat-value" id="managementScore">7.5/10</div>
                    <div class="stat-label">ìš´ì˜ìœ„ ë§Œì¡±ë„</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">ğŸª</div>
                    <div class="stat-value" id="selfScore">5.8/10</div>
                    <div class="stat-label">ì¡°í•©ì› ìê°€í‰ê°€</div>
                </div>
            </div>

            <!-- ì„¤ë¬¸ ë¬¸í•­ë“¤ -->
            <div class="sections" id="sectionsContainer">
                <!-- ë¬¸í•­ë“¤ì´ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
            </div>


        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let surveyData = null;
        let charts = {};

        // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ í•¨ìˆ˜
        function checkPassword() {
            const input = document.getElementById('passwordInput');
            const error = document.getElementById('passwordError');
            const passwordScreen = document.getElementById('passwordScreen');
            const mainContent = document.getElementById('mainContent');
            
            const correctPassword = 'ddobagi2025';
            
            if (input.value === correctPassword) {
                passwordScreen.classList.add('hidden');
                mainContent.classList.add('unlocked');
                error.style.display = 'none';
                
                sessionStorage.setItem('ddobagi_authenticated', 'true');
                loadSurveyData();
            } else {
                error.style.display = 'block';
                input.value = '';
                input.focus();
                
                input.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    input.style.animation = '';
                }, 500);
            }
        }
        
        // ì—”í„°í‚¤ë¡œ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
        document.getElementById('passwordInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkPassword();
            }
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸
        document.addEventListener('DOMContentLoaded', function() {
            const isAuthenticated = sessionStorage.getItem('ddobagi_authenticated');
            
            if (isAuthenticated === 'true') {
                document.getElementById('passwordScreen').classList.add('hidden');
                document.getElementById('mainContent').classList.add('unlocked');
                loadSurveyData();
            } else {
                setTimeout(() => {
                    document.getElementById('passwordInput').focus();
                }, 100);
            }
        });

        // ì‹¤ì œ ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„° ë¡œë“œ
        async function loadSurveyData() {
            const isAuthenticated = sessionStorage.getItem('ddobagi_authenticated');
            if (isAuthenticated !== 'true') {
                console.log('ì¸ì¦ë˜ì§€ ì•Šì€ ì ‘ê·¼');
                return;
            }
            
            try {
                // JSON íŒŒì¼ì—ì„œ ë°ì´í„° ë¡œë“œ
                const response = await fetch('/data/survey.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                surveyData = await response.json();
                console.log('JSON íŒŒì¼ì—ì„œ ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
                initializeDashboard();
            } catch (error) {
                console.error('ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                showError('ì„¤ë¬¸ì¡°ì‚¬ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. JSON íŒŒì¼ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
            }
        }

        // ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™”
        function initializeDashboard() {
            if (!surveyData) return;
            
            updateStats();
            createSections();
            
            console.log('ëŒ€ì‹œë³´ë“œ ì´ˆê¸°í™” ì™„ë£Œ');
        }

        // ìƒë‹¨ í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            const respondentCount = document.getElementById('respondentCount');
            const satisfactionScore = document.getElementById('satisfactionScore');
            const teacherScore = document.getElementById('teacherScore');
            const relationScore = document.getElementById('relationScore');
            const managementScore = document.getElementById('managementScore');
            const selfScore = document.getElementById('selfScore');
            
            if (surveyData.meta) {
                respondentCount.textContent = `${surveyData.meta.respondentCount || 35}ëª…`;
                satisfactionScore.textContent = `${surveyData.meta.satisfactionScore || 6.6}/10`;
            }
            
            // ê° ë¬¸í•­ì˜ ì ìˆ˜ë¥¼ ê°€ì ¸ì™€ì„œ ì—…ë°ì´íŠ¸
            const questions = surveyData.questions || [];
            questions.forEach(question => {
                if (question.id === 3 && teacherScore) {
                    teacherScore.textContent = `${question.score}/10`;
                }
                if (question.id === 4 && relationScore) {
                    relationScore.textContent = `${question.score}/10`;
                }
                if (question.id === 5 && managementScore) {
                    managementScore.textContent = `${question.score}/10`;
                }
                if (question.id === 6 && selfScore) {
                    selfScore.textContent = `${question.score}/10`;
                }
            });
        }

        // ì„¤ë¬¸ ì„¹ì…˜ë“¤ ìƒì„±
        function createSections() {
            const container = document.getElementById('sectionsContainer');
            const questions = surveyData.questions || [];
            
            container.innerHTML = '';
            
            questions.forEach((question, index) => {
                const sectionElement = createSectionElement(question, index + 1);
                container.appendChild(sectionElement);
            });
        }

        // ì„¹ì…˜ ìš”ì†Œ ìƒì„±
        function createSectionElement(question, questionNumber) {
            const section = document.createElement('div');
            section.className = 'section-card';
            section.innerHTML = `
                <div class="section-header" onclick="toggleSection('question${questionNumber}')">
                    <div class="section-title-area">
                        <div class="section-icon">${getQuestionIcon(question.type)}</div>
                        <div>
                            <div class="section-number">ì„¤ë¬¸ ë¬¸í•­ ${questionNumber}</div>
                            <div class="section-title">${question.title}</div>
                        </div>
                    </div>
                    <div class="chevron" id="chevron${questionNumber}">âŒ„</div>
                </div>
                <div class="section-content" id="content${questionNumber}">
                    ${createQuestionContent(question, questionNumber)}
                </div>
            `;
            
            return section;
        }

        // ì§ˆë¬¸ íƒ€ì…ë³„ ì•„ì´ì½˜ ë°˜í™˜
        function getQuestionIcon(type) {
            const icons = {
                'choice': 'ğŸ“Š',
                'satisfaction': 'â­',
                'narrative': 'ğŸ’¬',
                'combined': 'ğŸ“Š'
            };
            return icons[type] || 'ğŸ“Š';
        }

        // ì§ˆë¬¸ ë‚´ìš© ìƒì„±
        function createQuestionContent(question, questionNumber) {
            console.log(`ë¬¸í•­ ${questionNumber} ë°ì´í„°:`, question);
            
            switch (question.type) {
                case 'choice':
                    return createChartContent(question, questionNumber);
                case 'satisfaction':
                    return createSatisfactionContent(question);
                case 'narrative':
                    return createNarrativeContent(question);
                case 'combined':
                    return createCombinedContent(question, questionNumber);
                default:
                    return '<div class="coming-soon"><h4>ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤</h4><p>í•´ë‹¹ ì„¤ë¬¸ ë¬¸í•­ì˜ ë°ì´í„°ë¥¼ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p></div>';
            }
        }

        // ë§‰ëŒ€ê·¸ë˜í”„ ì°¨íŠ¸ ì½˜í…ì¸  ìƒì„± (ë¬¸í•­ 1, 2, 8, 9)
        function createChartContent(question, questionNumber) {
            let improvementSection = '';
            
            // ë¬¸í•­ 2ë²ˆì˜ ê²½ìš° ê¸ì •/ê°œì„  ì˜ê²¬ ì²˜ë¦¬ - ëœë¤ìœ¼ë¡œ ì„ê¸°
            if (questionNumber === 2 && (question.data.positive_comments || question.data.negative_comments)) {
                let allComments = [];
                if (question.data.positive_comments) {
                    allComments = allComments.concat(question.data.positive_comments);
                }
                if (question.data.negative_comments) {
                    allComments = allComments.concat(question.data.negative_comments);
                }
                
                // ëœë¤ìœ¼ë¡œ ì„ê¸°
                for (let i = allComments.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allComments[i], allComments[j]] = [allComments[j], allComments[i]];
                }
                
                improvementSection += `
                    <div class="narrative-content" style="margin-top: 2rem;">
                        <div class="narrative-section">
                            ${allComments.map(response => `
                                <div class="quote-card">
                                    <p class="quote-text">${response}</p>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            // ë¬¸í•­ 8, 9ë²ˆì˜ ê²½ìš° "ì¶”ê°€ ì˜ê²¬"ìœ¼ë¡œ í‘œê¸°
            if (question.improvements) {
                const titleText = (questionNumber === 8 || questionNumber === 9) ? "ğŸ’­ ì¶”ê°€ ì˜ê²¬" : "ğŸ’¬ ê¸°íƒ€ ì˜ê²¬";
                improvementSection += `
                    <div class="narrative-section" style="margin-top: 2rem;">
                        <h4 class="narrative-title">${titleText}</h4>
                        ${question.improvements.map(response => `
                            <div class="quote-card">
                                <p class="quote-text">${response}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // JSONì—ì„œ responses ë°°ì—´ì´ ìˆëŠ” ê²½ìš° ì²˜ë¦¬
            if (question.data.responses) {
                const titleText = (questionNumber === 8 || questionNumber === 9) ? "ğŸ’­ ì¶”ê°€ ì˜ê²¬" : "ğŸ’¬ ê¸°íƒ€ ì˜ê²¬";
                improvementSection += `
                    <div class="narrative-section" style="margin-top: 2rem;">
                        <h4 class="narrative-title">${titleText}</h4>
                        ${question.data.responses.map(response => `
                            <div class="quote-card">
                                <p class="quote-text">${response}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            return `
                <div class="chart-container">
                    <div class="chart-wrapper">
                        <canvas id="chart${questionNumber}"></canvas>
                    </div>
                    ${improvementSection}
                </div>
            `;
        }

        // í†µí•© ì½˜í…ì¸  ìƒì„± (ë¬¸í•­ 2: ì°¨íŠ¸ + ì„œìˆ í˜•ì„ ì„¸ë¡œë¡œ ë°°ì¹˜)
        function createCombinedContent(question, questionNumber) {
            // ê¸ì •/ë¶€ì • ì˜ê²¬ì„ ëœë¤ìœ¼ë¡œ ì„ê¸°
            let allComments = [];
            if (question.data.positive_comments) {
                allComments = allComments.concat(question.data.positive_comments);
            }
            if (question.data.negative_comments) {
                allComments = allComments.concat(question.data.negative_comments);
            }
            
            // ëœë¤ìœ¼ë¡œ ì„ê¸°
            for (let i = allComments.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allComments[i], allComments[j]] = [allComments[j], allComments[i]];
            }
            
            return `
                <div class="combined-section">
                    <div class="chart-container">
                        <div class="chart-wrapper">
                            <canvas id="chart${questionNumber}"></canvas>
                        </div>
                    </div>
                    <div class="narrative-content">
                        ${allComments.length > 0 ? `
                            <div class="narrative-section">
                                ${allComments.map(response => `
                                    <div class="quote-card">
                                        <p class="quote-text">${response}</p>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // ë§Œì¡±ë„ ì ìˆ˜ í‘œì‹œ (í…ìŠ¤íŠ¸ë§Œ, ê·¸ë˜í”„ ì—†ìŒ)
        function createSatisfactionContent(question) {
            // ê¸ì •/ë¶€ì • ì˜ê²¬ì„ ëœë¤ìœ¼ë¡œ ì„ê¸°
            let allComments = [];
            if (question.data.positive_comments) {
                allComments = allComments.concat(question.data.positive_comments);
            }
            if (question.data.negative_comments) {
                allComments = allComments.concat(question.data.negative_comments);
            }
            
            // ëœë¤ìœ¼ë¡œ ì„ê¸°
            for (let i = allComments.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allComments[i], allComments[j]] = [allComments[j], allComments[i]];
            }
            
            return `
                <div style="display: grid; grid-template-columns: 1fr; gap: 2rem;">
                    <div style="text-align: center; padding: 2rem; background: rgba(255,255,255,0.5); border-radius: 12px;">
                        <div style="font-size: 3rem; font-weight: bold; color: white; margin-bottom: 0.5rem;">${question.score}/10</div>
                        <div style="color: rgba(255,255,255,0.8); font-weight: bold;">í‰ê·  ë§Œì¡±ë„</div>
                    </div>
                    <div class="narrative-content">
                        ${allComments.length > 0 ? `
                            <div class="narrative-section">
                                ${allComments.map(response => `
                                    <div class="quote-card">
                                        <p class="quote-text">${response}</p>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        ${question.data.responses && !question.data.positive_comments && !question.data.negative_comments ? `
                            <div class="narrative-section">
                                <h4 class="narrative-title">ğŸ’¬ ê¸°íƒ€ ì˜ê²¬</h4>
                                ${question.data.responses.map(response => `
                                    <div class="quote-card">
                                        <p class="quote-text">${response.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;')}</p>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        // ì„œìˆ í˜• ì½˜í…ì¸  ìƒì„±
        function createNarrativeContent(question) {
            let content = '';
            
            // positiveì™€ improvement ì˜ê²¬ì„ ëœë¤ìœ¼ë¡œ ì„ê¸°
            let allComments = [];
            if (question.data.positive) {
                allComments = allComments.concat(question.data.positive);
            }
            if (question.data.improvement) {
                allComments = allComments.concat(question.data.improvement);
            }
            
            // ëœë¤ìœ¼ë¡œ ì„ê¸°
            for (let i = allComments.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allComments[i], allComments[j]] = [allComments[j], allComments[i]];
            }
            
            if (allComments.length > 0) {
                content += `
                    <div class="narrative-section">
                        ${allComments.map(response => `
                            <div class="quote-card">
                                <p class="quote-text">${response}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            if (question.data.responses && !question.data.positive && !question.data.improvement) {
                content = `
                    <div class="narrative-section">
                        <h4 class="narrative-title">ğŸ’¬ ì‘ë‹µ ë‚´ìš©</h4>
                        ${question.data.responses.map(response => `
                            <div class="quote-card">
                                <p class="quote-text">${response}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            return `<div class="narrative-grid">${content}</div>`;
        }



        // ì„¹ì…˜ í† ê¸€ ê¸°ëŠ¥
        function toggleSection(sectionId) {
            const questionNumber = sectionId.replace('question', '');
            const content = document.getElementById(`content${questionNumber}`);
            const chevron = document.getElementById(`chevron${questionNumber}`);
            
            if (!content || !chevron) return;
            
            if (content.classList.contains('active')) {
                content.classList.remove('active');
                chevron.classList.remove('rotated');
            } else {
                content.classList.add('active');
                chevron.classList.add('rotated');
                
                // ì°¨íŠ¸ê°€ ìˆëŠ” ì„¹ì…˜ì´ë©´ ì°¨íŠ¸ ê·¸ë¦¬ê¸°
                if (questionNumber && !isNaN(questionNumber)) {
                    const question = surveyData.questions[parseInt(questionNumber) - 1];
                    if (question && (question.type === 'choice' || question.type === 'combined')) {
                        setTimeout(() => createChart(parseInt(questionNumber)), 100);
                    }
                }
            }
        }

        // ê°€ë¡œí˜• ë§‰ëŒ€ê·¸ë˜í”„ ì°¨íŠ¸ ìƒì„±
        function createChart(questionNumber) {
            const question = surveyData.questions[questionNumber - 1];
            if (!question || charts[`chart${questionNumber}`]) return;
            
            let chartData;
            if (question.type === 'combined') {
                // combined íƒ€ì…ì˜ ê²½ìš° data.choicesë¥¼ ì‚¬ìš©
                if (question.data && question.data.choices) {
                    chartData = question.data.choices.map(item => ({
                        reason: item.reason,
                        percentage: item.percentage
                    }));
                } else {
                    console.log('Combined íƒ€ì… ì°¨íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤:', question);
                    return;
                }
            } else if (question.type === 'choice') {
                // choice íƒ€ì…ì˜ ê²½ìš° data.choicesë¥¼ ì‚¬ìš©
                if (question.data && question.data.choices) {
                    chartData = question.data.choices.map(item => ({
                        reason: item.reason,
                        percentage: item.percentage
                    }));
                } else if (question.data && Array.isArray(question.data)) {
                    // ê¸°ì¡´ ë°°ì—´ í˜•íƒœë„ ì§€ì›
                    chartData = question.data;
                } else {
                    console.log('Choice íƒ€ì… ì°¨íŠ¸ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤:', question);
                    return;
                }
            } else {
                return;
            }
            
            const ctx = document.getElementById(`chart${questionNumber}`);
            if (!ctx) return;
            
            console.log(`ë¬¸í•­ ${questionNumber} ì°¨íŠ¸ ë°ì´í„°:`, chartData);
            
            // ê°€ë¡œí˜• ë§‰ëŒ€ê·¸ë˜í”„ ì„¤ì •
            const chartConfig = {
                type: 'bar',
                data: {
                    labels: chartData.map(item => item.reason),
                    datasets: [{
                        data: chartData.map(item => item.percentage),
                        backgroundColor: 'rgba(70, 130, 180, 0.8)',
                        borderColor: 'rgba(70, 130, 180, 1)',
                        borderWidth: 1,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y', // ê°€ë¡œí˜• ë§‰ëŒ€ê·¸ë˜í”„ë¡œ ì„¤ì •
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(context) {
                                    const index = context[0].dataIndex;
                                    return chartData[index].reason;
                                },
                                label: function(context) {
                                    const index = context.dataIndex;
                                    const item = chartData[index];
                                    const count = item.count || Math.round(item.percentage * 35 / 100);
                                    return `${count}ëª… (${item.percentage}%)`;
                                }
                            }
                        },
                        // ì°¨íŠ¸ ì™¸ë¶€ì— ë¼ë²¨ í‘œì‹œ
                        datalabels: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            ticks: { 
                                color: 'white',
                                font: {
                                    weight: 'bold'
                                },
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.2)',
                                display: true
                            }
                        },
                        y: {
                            ticks: { 
                                color: 'white',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                callback: function(value, index) {
                                    const item = chartData[index];
                                    const count = item.count || Math.round(item.percentage * 35 / 100);
                                    return `${item.reason} (${count}ëª…, ${item.percentage}%)`;
                                }
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                display: false
                            }
                        }
                    },
                    animation: {
                        duration: 1000,
                        easing: 'easeOutQuart'
                    }
                }
            };
            
            charts[`chart${questionNumber}`] = new Chart(ctx, chartConfig);
        }

        // ì—ëŸ¬ í‘œì‹œ
        function showError(message) {
            const container = document.getElementById('sectionsContainer');
            container.innerHTML = `
                <div class="section-card">
                    <div style="padding: 3rem; text-align: center; color: rgba(255,255,255,0.8);">
                        <h3 style="margin-bottom: 1rem;">âš ï¸ ì˜¤ë¥˜ ë°œìƒ</h3>
                        <p>${message}</p>
                        <p style="margin-top: 1rem; font-size: 0.9rem; opacity: 0.7;">
                            ë¸Œë¼ìš°ì € ì½˜ì†”ì„ í™•ì¸í•´ë³´ì„¸ìš”.
                        </p>
                    </div>
                </div>
            `;
        }
    </script>
</body>
</html>